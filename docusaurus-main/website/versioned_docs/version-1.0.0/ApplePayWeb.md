---
id: version-1.0.0-ApplePayWeb
title: Web
original_id: ApplePayWeb
---

## Apple Pay purchase operation

To integrate the Apple Pay button on the payment page of an online store, you need to implement the ApplePaySession.canMakePaymentsWithActiveCard method, this method determines whether this device supports payment using Apple Pay.

If it supports payment, you need to draw the “Buy using Apple Pay” button.

Next, you need to create an object **ApplePaySession**, with the purchase parameters:

``` js
  countryCode: 'UA',
  currencyCode: 'UAH',
  supportedNetworks: ['visa', 'masterCard'],
  merchantCapabilities: ['supports3DS'],
  total: { label: 'Your Merchant Name', amount: '10.00' },

```
For a description of the fields, see the Apple Pay on Web documentation.


On the event **onvalidatemerchant** you need to hang a handler in which it will be called API “api/apple/validate” . 
The description of the method will be below.

On the event **onpaymentauthorized** you need to hang a handler that will call API “api/apple/payment”.

After confirming the payment in **onpaymentauthorized**, you must call the method

**ApplePaySession.completePayment**.


ApplePaySession documentation can be found on the Apple site.
(https://developer.apple.com/documentation/apple_pay_on_the_web/apple_pay_js_api).


## Merchant Validation Apple Pay (api/apple/validate). 
 
 **Production url:** https://pay.concord.ua/api/apple/validate
 
 POST parametrs:
 | Parameter             | Description                                                                                                                                                                          | Value |
 |----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
 | operation            | Type of transaction                                                                                                                                                                      | Purchase |
 | apple_validation_url |  This parameter comes in the event  onvalidatemerchant, event.validationURL                                                                                                        |          |
 |                      | Example:                                                                                                                                                                           |          |
 |                      | session.onvalidatemerchant = (event) => {                                                                                                                                         |          |
 |                      |         console.log(event.validationURL);                                                                                                                                         |          |
 |                      | }                                                                                                                                                                                 |          |
 | merchant_id          | merchant identifier                                                                                                                                             |          |
 | amount               | The amount of the transaction. Example 500.00                                                                                                                                                    |          |
 | signature            | In order to confirm the validity of the data, a verification signature must be generated and transmitted in the HMAC_MD5 request using the SecretKey merchant.                          |          |
 |                      | The string to be HMAC_MD5 is generated by concatenating the parameters merchant_id, order_id, amount, currency_iso, description separated by “;” (semicolon) in UTF-8 encoding. |          |
 |                      | **The order of parameters during concatenation is important!**                                                                                                                                        |          |
 | order_id             | Unique transaction number on the merchant side. If the operation is duplicated, the merchant receives an error.                                                                              |          |
 | currency_iso         | Currency of payment.                                                                                                                                                                   | UAH      |
 | description          | Purpose of payment. It is displayed on the payment page when entering payment details. Displayed in the account statement and registries                                                  |          |
 | add_params           | An array with additional parameters. Additional parameters are then returned to the merchant in a callback call                                                                     |          |
 | callback_url         | URL to which information about the result of the payment will be sent                                                                                                                  |          |
 

The following parameters come in response:

| Parameter            | Description                                                                       |
|---------------------|--------------------------------------------------------------------------------|
| apple_validate_data | Data to pass to session.completeMerchantValidation method |
| order_key           | Order ID in the payment system                                       |
| code                | Answer code if 0 - everything is ok                                                    |
| message             | Decoding of the response code                                                        |


## Payment confirmation Apple Pay (api/apple/payment)

**Production url:**   https://pay.concord.ua/api/apple/payment

POST parameters:

| Parameter               | Description                                                                                                |
|------------------------|---------------------------------------------------------------------------------------------------------|
| order_key              | Order ID in the payment system                                                                |
| apple_pay_payment_data | Base64 encoded data received in new event onpaymentauthorized in parameter  event.payment. |
|                        | Example:                                                                                                 |
|                        | session.onpaymentauthorized = (event) => {                                                              |
|                        |         console.log(event.payment);                                                                     |
|                        | }                                                                                                       |
|                        |                                                                                                         |

The answer comes:

| transactionStatus | Transaction Status        | Approved - Successfully / Declined - Renouncement  |
|-------------------|--------------------------|--------------------|
| reason            | Text reason for rejection|                    |
| reasonCode        | Failure Error Code    |                    |

After calling this method, a callback comes to the backend trader.
 


 

 